<!DOCTYPE html>
<html>
<head>
    <title>Home Controller</title>
    <script>
        function measure() {
            // // ë²„íŠ¼ ë¹„í™œì„±í™” ë° ë¡œë”© í‘œì‹œ
            // const measureBtn = event.target;
            // measureBtn.disabled = true;
            // measureBtn.textContent = 'ì¸¡ì • ì¤‘...';
            // document.getElementById("result").innerHTML = "ğŸ”„ ì¸¡ì • ì¤‘...";
            
            fetch("/measure", {
                    method: "POST"
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById("measure-result").innerHTML = `
                        ğŸŒ¡ ì˜¨ë„: ${data.temperature}â„ƒ <br>
                        ğŸ’§ ìŠµë„: ${data.humidity}% <br>
                        ğŸ“… ì¸¡ì • ì‹œê°„: ì§€ê¸ˆ
                        `;
                    } else {
                        document.getElementById("measure-result").innerHTML = `
                        âŒ ì¸¡ì • ì‹¤íŒ¨: ${data.error}
                        `;
                    }
                })
                .catch(err => {
                    document.getElementById("measure-result").innerHTML =
                        "âŒ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: " + err;
                })
                .finally(() => {
                    // ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
                    measureBtn.disabled = false;
                    measureBtn.textContent = 'ğŸ“¥ ì¸¡ì •';
                });
        }

        // LED ì œì–´ë¥¼ AJAXë¡œ ë³€ê²½ (í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ë°©ì§€)
        function toggleLED() {
            const ledBtn = event.target;
            ledBtn.disabled = true;
            
            fetch("/ledControl", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        ledBtn.textContent = data.button_text || 'LED ì œì–´';
                        document.getElementById("led-status").textContent = data.led_state ? 'ON' : 'OFF';
                    } else {
                        alert('LED ì œì–´ ì‹¤íŒ¨');
                    }
                })
                .catch(err => {
                    console.error('LED ì œì–´ ì˜¤ë¥˜:', err);
                    // ì˜¤ë¥˜ ì‹œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ í´ë°±
                    window.location.reload();
                })
                .finally(() => {
                    ledBtn.disabled = false;
                });
        }
    </script>
</head>
<body>
    <h2>í™˜ì˜í•©ë‹ˆë‹¤, {{ user_nick }}ë‹˜!</h2>

    <h3>ğŸ“Š ìµœê·¼ ì˜¨ìŠµë„ ì •ë³´</h3>
    <!-- ğŸ“‹ ê°€ì¥ ìµœê·¼ ì •ë³´ -->
    <div id="measure-result">
    ğŸŒ¡ ì˜¨ë„: {{ temp }}â„ƒ <br>
    ğŸ’§ ìŠµë„: {{ humid }}% <br>
    ğŸ“… ì¸¡ì •ì¼: {{ date }}
    </div>
<!-- ğŸŒ¡ ì¸¡ì • ë²„íŠ¼ -->
    <button onclick="measureTemp()">ğŸŒ¡ ì‹¤ì‹œê°„ ì¸¡ì •</button>
    <p id="result">â€» ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¸¡ì •í•´ë³´ì„¸ìš”!</p>
    
    <br><br>
    
    <h3>ğŸ’¡ LED ì œì–´</h3>
    <p>í˜„ì¬ ìƒíƒœ: <span id="led-status">{{ 'ON' if led_state else 'OFF' }}</span></p>
    
    <!-- AJAX ë°©ì‹ìœ¼ë¡œ ë³€ê²½ -->
    <button onclick="toggleLED()">{{ 'OFF' if led_state else 'ON' }}</button>
    
    <!-- ê¸°ì¡´ form ë°©ì‹ë„ ë‚¨ê²¨ë‘  (ë°±ì—…ìš©) -->
    <!-- 
    <form action="/ledControl" method="post">
        <button type="submit">{{ 'OFF' if led_state else 'ON' }}</button>
    </form>
    -->

    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        h2, h3 {
            color: #333;
        }
        
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:hover {
            background-color: #0056b3;
        }
        
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        
        #result {
            font-weight: bold;
            margin: 10px 0;
        }
        
        span {
            font-weight: bold;
            color: #007bff;
        }
    </style>
</body>
</html>